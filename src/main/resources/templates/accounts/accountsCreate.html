<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<div layout:fragment="content">
    <div id="content" class="sub-page clusters">
        <article class="location">
        </article>
        <article class="base">
            <div class="creat">
                <h3 th:text="|Accounts #{M0022}|"></h3>
                <div>
                    <dl>
                        <dt><label for="accountsName">Name</label></dt>
                        <dd>
                            <input id="accountsName" type="text"/>
                        </dd>
                    </dl>
                    <dl>
                        <dt><label for="storageType">Storage Type</label></dt>
                        <dd>
                            <fieldset>
                                <select id="storageType">
                                    <option value="s3">S3</option>
                                </select>
                            </fieldset>
                        </dd>
                    </dl>
                    <dl>
                        <dt><label for="endpoint">Endpoint</label></dt>
                        <dd>
                            <input id="endpoint" type="text"/>
                        </dd>
                    </dl>
                    <dl>
                        <dt><label for="accessKeyId">Access Key Id</label></dt>
                        <dd>
                            <input id="accessKeyId" type="text"/>
                        </dd>
                    </dl>
                    <dl>
                        <dt><label for="secretAccessKey">Secret Access Key</label></dt>
                        <dd>
                            <input id="secretAccessKey" type="text"/>
                        </dd>
                    </dl>
                </div>
            </div>
            <!-- btn -->
            <div class="btn02">
                <button onclick="movePage(URI_CP_ACCOUNTS_LIST);" th:text="#{M0025}"></button>
                <div>
                    <button type="submit" id="save" th:text="#{M0026}"></button>
                </div>
            </div>
        </article>
    </div>
</div>

<th:block layout:fragment="script">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha256.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/enc-base64-min.js"></script>
    <script type="text/javascript" src="/js/jsencrypt.min.js"></script>
    <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>-->
    <script type="text/javascript">
    /*<script type="module">*/

        window.onload = () => {

            const accountsCreate = {

                event() {
                    let accountsName = document.querySelector('#accountsName');
                    let storageType = document.querySelector('#storageType');
                    let endpoint = document.querySelector('#endpoint');
                    let accessKeyId = document.querySelector('#accessKeyId');
                    let secretAccessKey = document.querySelector('#secretAccessKey');

                    document.getElementById('save').addEventListener('click', () => {

                        if (accountsName.value === '' || storageType.value === '' || endpoint.value === '' || accessKeyId.value === '' || secretAccessKey.value === '') {
                            func.alertPopup('CHECK', MSG_CHECK_TO_VALUE, true, MSG_CONFIRM, 'closed');
                        } else if (accountsName.value !== '' && storageType.value !== '' && endpoint.value !== '' && accessKeyId.value !== '' && secretAccessKey.value !== '') {
                            func.alertPopup('SAVE', MSG_CHECK_TO_SAVE, true, MSG_CONFIRM, accountsCreate.save);
                        }

                    }, false);

                },

                save() {

                    let timestamp = func.createUnixTimestamp();
                    alert("timestamp::: " + timestamp)
                    console.log("timestamp::: " + JSON.stringify(timestamp))



                    let accountsName = document.getElementById('accountsName').value;
                    let storageType = document.getElementById('storageType').value;
                    let endpoint = document.getElementById('endpoint').value;
                    let accessKeyId = document.getElementById('accessKeyId').value;
                    let secretAccessKey = document.getElementById('secretAccessKey').value;

                    /*let accountsCreate = {
                        "basePath": "jjyStorage",
                        "userAccount": sessionStorage.getItem('userGuid'),
                        "configName": accountsName,
                        "content": {
                            "storageType": storageType,
                            "endpoint": endpoint,
                            "accessKeyId": accessKeyId,
                            "secretAccessKey": secretAccessKey,
                        }
                    }

                    let includeTimestampData = {
                        accountsCreate,
                        "timestamp": timestamp
                    }*/

                    let accountsCreate = {
                        "basePath": "asd",
                        "userAccount": "sdf",
                        "configName": "dfg",
                        "content": {
                            "storageType": "qwe",
                            "endpoint": "wer",
                            "accessKeyId": "ert",
                            "secretAccessKey": "rty"
                        }
                    }

                    let includeTimestampData = {
                        "data": {
                            "basePath": "asd",
                            "userAccount": "sdf",
                            "configName": "dfg",
                            "content": {
                                "storageType": "qwe",
                                "endpoint": "wer",
                                "accessKeyId": "ert",
                                "secretAccessKey": "rty"
                            }
                        },
                        "timestamp": "1744597671569076100"
                    }

                    alert("includeTimestampData::: " + JSON.stringify(includeTimestampData))
                    console.log("includeTimestampData::: " + JSON.stringify(includeTimestampData))

                    alert("accountsCreate::: " + JSON.stringify(accountsCreate))
                    console.log("accountsCreate::: " + JSON.stringify(accountsCreate))

                    let hmacData = func.encodeHmacSha256(JSON.stringify(includeTimestampData));
                    alert("hmacData::: "+ hmacData)
                    console.log("hmacData::: "+ hmacData)

                    let includeHmacData = {
                        "data": accountsCreate,
                        "hmac_data": hmacData,
                        //"timestamp": 1744597671569076100 //timestamp,
                        "timestamp": "1744597671569076100" //timestamp,
                    }
                    alert("includeHmacData::: "+ JSON.stringify(includeHmacData))
                    console.log("includeHmacData::: "+ JSON.stringify(includeHmacData))


                    let rsaData = func.encodeRsa(includeHmacData)
                    alert("RsaData::: "+ JSON.stringify(rsaData))
                    console.log("RsaData::: "+ JSON.stringify(rsaData))

                    let decodeRsaData = func.decodeRsa(rsaData)
                    alert("decodeRsaData::: "+ JSON.stringify(decodeRsaData))
                    console.log("decodeRsaData::: "+ JSON.stringify(decodeRsaData))

                    let security = {
                        "payload": rsaData
                    }

                    alert("security::: "+ JSON.stringify(security))
                    console.log("security::: "+ JSON.stringify(security))


                    //createHmac()

                    /*let hmacData = func.createHmacData(accountsCreate)
                    alert("hmacData::: " + hmacData)*/
                    //import cryptojs from "crypto-js";
                    /*const cryptojs = require("crypto-js");
                    const data = accountsCreate;
                    const key = "secret";
                    alert(cryptojs.HmacSHA256(data, key).toString(cryptojs.enc.Hex));*/





                    //func.saveData('POST', `${func.vaultUrl}v1/vault`, JSON.stringify(accountsCreate), true, 'application/json', func.historyBack);
                    func.saveData('POST', `http://192.168.0.5:8911/v1/vault`, JSON.stringify(accountsCreate), true, 'application/json', func.historyBackRefresh);

                    sessionStorage.setItem('accountsData', 'Y')
                },
            };
            accountsCreate.event();
        };

        /*function Unix_timestampConv()
        {
            alert("타임스탬프::" + Math.floor(new Date().getTime() / 1000))
            return Math.floor(new Date().getTime() / 1000);
        }*/
   /* function createHmac() {

        var textString=CryptoJS.HmacSHA256("message","secret").toString(CryptoJS.enc.Hex);
        alert("hmac::: " + textString)
    }*/
   /* function rsa () {
        const rsa = new JSEncrypt();
        rsa.encrypt(data).toString();
    }*/


    </script>
</th:block>
</html>
